{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}Reset Password - UniLib{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-purple-50 to-indigo-100 py-8 px-4 sm:px-6 lg:px-8">
    <!-- Floating Background Elements -->
    <div class="fixed inset-0 overflow-hidden pointer-events-none">
        <div class="absolute top-20 left-10 text-purple-200 opacity-40 animate-float">
            <i class="fas fa-key text-6xl"></i>
        </div>
        <div class="absolute top-40 right-20 text-indigo-200 opacity-30 animate-float-delayed">
            <i class="fas fa-envelope text-4xl"></i>
        </div>
        <div class="absolute bottom-40 left-20 text-purple-200 opacity-25 animate-float">
            <i class="fas fa-shield-alt text-5xl"></i>
        </div>
        <div class="absolute bottom-20 right-10 text-indigo-200 opacity-20 animate-float-delayed">
            <i class="fas fa-user-lock text-6xl"></i>
        </div>
    </div>

    <div class="max-w-6xl mx-auto relative z-10">
        <!-- Page Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 font-serif mb-4">
                <i class="fas fa-key mr-3 text-indigo-600"></i>
                Reset Your Password
            </h1>
            <p class="text-gray-600 text-lg">Enter your email to receive a secure reset link</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Visual Security Section -->
            <div class="bg-white/95 backdrop-blur-lg border border-white/20 rounded-3xl shadow-2xl overflow-hidden">
                <!-- Card Header -->
                <div class="bg-gradient-to-r from-purple-600 to-indigo-600 py-6 px-8">
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-full bg-white/20 flex items-center justify-center mr-4">
                            <i class="fas fa-envelope text-white text-xl"></i>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-white">Password Recovery</h2>
                            <p class="text-purple-100">Secure email verification process</p>
                        </div>
                    </div>
                </div>

                <!-- Security Content -->
                <div class="p-8">
                    <!-- Animated Email Icon -->
                    <div class="flex justify-center mb-8">
                        <div class="relative">
                            <div class="w-32 h-32 rounded-full bg-purple-100 flex items-center justify-center animate-pulse">
                                <i class="fas fa-envelope-open-text text-purple-600 text-5xl"></i>
                            </div>
                            <div class="absolute -top-2 -right-2 w-10 h-10 rounded-full bg-green-500 flex items-center justify-center">
                                <i class="fas fa-paper-plane text-white text-sm"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Security Features -->
                    <div class="space-y-6">
                        <div class="bg-purple-50 rounded-2xl p-6 border-l-4 border-purple-500">
                            <h3 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-shield-check text-purple-600 mr-3"></i>
                                How It Works
                            </h3>
                            <ul class="space-y-3">
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                                    <span class="text-gray-700">Enter your registered email address</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                                    <span class="text-gray-700">Receive a secure reset link via email</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                                    <span class="text-gray-700">Create a new strong password</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                                    <span class="text-gray-700">Regain access to your account</span>
                                </li>
                            </ul>
                        </div>

                        <!-- Security Information -->
                        <div class="bg-indigo-50 rounded-2xl p-6 border-l-4 border-indigo-500">
                            <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center">
                                <i class="fas fa-info-circle text-indigo-600 mr-3"></i>
                                Security Features
                            </h4>
                            <div class="space-y-3">
                                <div class="flex items-start">
                                    <i class="fas fa-clock text-purple-500 mr-3 mt-1"></i>
                                    <span class="text-gray-700">Reset links expire after 24 hours</span>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-key text-purple-500 mr-3 mt-1"></i>
                                    <span class="text-gray-700">One-time use only for security</span>
                                </div>
                                <div class="flex items-start">
                                    <i class="fas fa-shield-alt text-purple-500 mr-3 mt-1"></i>
                                    <span class="text-gray-700">Encrypted email communication</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Password Reset Form -->
            <div class="bg-white/95 backdrop-blur-lg border border-white/20 rounded-3xl shadow-2xl overflow-hidden">
                <!-- Form Header -->
                <div class="bg-gradient-to-r from-indigo-600 to-purple-600 py-6 px-8">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        <i class="fas fa-paper-plane mr-3"></i>
                        Request Reset Link
                    </h2>
                    <p class="text-indigo-100 mt-2">Enter your email to get started</p>
                </div>

                <!-- Form Content -->
                <div class="p-8">
                    {% if form.non_field_errors %}
                    <div class="bg-red-50 border-l-4 border-red-500 rounded-r-2xl p-6 mb-6">
                        <div class="flex">
                            <div class="flex-shrink-0">
                                <i class="fas fa-exclamation-circle text-red-500 text-xl"></i>
                            </div>
                            <div class="ml-4">
                                <h3 class="text-sm font-bold text-red-800">Unable to send reset link</h3>
                                <div class="mt-2 text-sm text-red-700">
                                    {% for error in form.non_field_errors %}
                                        <p>{{ error }}</p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}

                    <form method="POST" id="password-reset-form">
                        {% csrf_token %}
                        
                        <!-- Email Field -->
                        <div class="mb-6">
                            <label for="id_email" class="block text-sm font-medium text-gray-700 mb-3 flex items-center">
                                <i class="fas fa-envelope text-indigo-600 mr-2"></i>
                                Email Address
                            </label>
                            <div class="relative">
                                <input type="email" 
                                       name="email" 
                                       id="id_email" 
                                       class="w-full pl-12 pr-4 py-4 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-300 focus:transform focus:-translate-y-1" 
                                       placeholder="Enter your registered email"
                                       required
                                       value="{{ form.email.value|default:'' }}">
                                <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
                                    <i class="fas fa-envelope"></i>
                                </div>
                            </div>
                            {% if form.email.errors %}
                                <div class="mt-2 text-sm text-red-600 flex items-center">
                                    <i class="fas fa-exclamation-circle mr-2"></i>
                                    {{ form.email.errors.0 }}
                                </div>
                            {% else %}
                                <div class="mt-2 text-sm text-gray-500 flex items-center">
                                    <i class="fas fa-info-circle text-blue-500 mr-2"></i>
                                    Enter the email address associated with your account
                                </div>
                            {% endif %}
                        </div>

                        <!-- Form Actions -->
                        <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                            <a href="{% url 'login' %}" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center">
                                <i class="fas fa-arrow-left mr-3"></i> Back to Login
                            </a>
                            <button type="submit" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 shadow-lg flex items-center justify-center" id="submit-button">
                                <i class="fas fa-paper-plane mr-3"></i> 
                                <span id="button-text">Send Reset Link</span>
                            </button>
                        </div>

                        <!-- Additional Help -->
                        <div class="mt-6 pt-6 border-t border-gray-200 text-center">
                            <p class="text-gray-600 text-sm">
                                Remember your password? 
                                <a href="{% url 'login' %}" class="text-indigo-600 hover:text-indigo-700 font-semibold transition-colors">
                                    Sign in to your account
                                </a>
                            </p>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Security Notice -->
        <div class="mt-8 bg-white/80 backdrop-blur-sm rounded-2xl p-6 border border-purple-200">
            <div class="flex items-start">
                <i class="fas fa-shield-alt text-purple-500 text-2xl mr-4 mt-1"></i>
                <div>
                    <h4 class="font-semibold text-gray-800 mb-2">Privacy & Security</h4>
                    <p class="text-gray-600">
                        Your email address will only be used to send password reset instructions. 
                        We respect your privacy and will not share your information with third parties. 
                        The reset link is secure and can only be used once within 24 hours.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        50% { transform: translateY(-20px) rotate(5deg); }
    }
    
    .animate-float {
        animation: float 6s ease-in-out infinite;
    }
    
    .animate-float-delayed {
        animation: float 8s ease-in-out infinite;
        animation-delay: 2s;
    }
    
    @keyframes pulse {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.7; }
    }
    
    .animate-pulse {
        animation: pulse 2s ease-in-out infinite;
    }
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Form submission with loading state
    const form = document.getElementById('password-reset-form');
    const submitButton = document.getElementById('submit-button');
    const buttonText = document.getElementById('button-text');
    
    if (form && submitButton && buttonText) {
        form.addEventListener('submit', function() {
            // Show loading state
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-3"></i> Sending Link...';
            submitButton.disabled = true;
            submitButton.classList.remove('hover:scale-105');
        });
    }

    // Add focus effects to form fields
    const emailInput = document.getElementById('id_email');
    if (emailInput) {
        emailInput.addEventListener('focus', function() {
            this.parentElement.classList.add('ring-2', 'ring-indigo-200');
        });
        
        emailInput.addEventListener('blur', function() {
            this.parentElement.classList.remove('ring-2', 'ring-indigo-200');
        });
    }

    // Add hover effects to security cards
    const securityCards = document.querySelectorAll('.bg-purple-50, .bg-indigo-50');
    securityCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });

    // Add subtle animation to email icon
    const emailIcon = document.querySelector('.fa-envelope-open-text');
    if (emailIcon) {
        setTimeout(() => {
            emailIcon.classList.add('animate-pulse');
        }, 1000);
    }

    // Auto-focus on email input for better UX
    if (emailInput) {
        setTimeout(() => {
            emailInput.focus();
        }, 500);
    }
});
</script>
{% endblock %}